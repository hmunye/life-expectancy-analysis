---
title: "Outliers for Life Expectancy Data Set"
format: html
editor: visual
---

## Import Life Expectancy Data Set

```{r}
df <- read_csv("https://raw.githubusercontent.com/hmunye/life-expectancy-analysis/main/data/Life-Expectancy-Data-Updated.csv", show_col_types = FALSE)
```

## Importing Libraries

```{r}
library(tidyverse)
library(DescTools)
```

## Find Number of Outliers and Plot:

```{r}
num_outliers <- function(data_set, column) {
  q1 <- quantile(column, 0.25)
  q3 <- quantile(column, 0.75)
  iqr <- q3 -q1
  
  upper_bound <- q3 + 1.5 * iqr
  lower_bound <- q1 - 1.5 * iqr
  
  outliers <- column[column < lower_bound | column > upper_bound]
  
  plot <- ggplot(data_set) + geom_boxplot(aes(x = "", y = column))
  
  print(plot)
  
  return(length(outliers))
}
```

```{r}
num_outliers(df, df$Infant_deaths)
```

```{r}
num_outliers(df, df$Under_five_deaths)
```

```{r}
num_outliers(df, df$Adult_mortality)
```

```{r}
num_outliers(df, df$Alcohol_consumption)
```

```{r}
num_outliers(df, df$Hepatitis_B)
```

```{r}
num_outliers(df, df$Measles)
```

```{r}
num_outliers(df, df$BMI)
```

```{r}
num_outliers(df, df$Polio)
```

```{r}
num_outliers(df, df$Diphtheria)
```

```{r}
num_outliers(df, df$Incidents_HIV)
```

```{r}
num_outliers(df, df$GDP_per_capita)
```

```{r}
num_outliers(df, df$Population_mln)
```

```{r}
num_outliers(df, df$Thinness_ten_nineteen_years)
```

```{r}
num_outliers(df, df$Thinness_five_nine_years)
```

```{r}
num_outliers(df, df$Schooling)
```

```{r}
num_outliers(df, df$Life_expectancy)
```

## Facet By Region:

```{r}
outlier_by_regions <- function(data_set, column) {
  data_set %>%
  ggplot() +
  geom_boxplot(aes(x = "", y = column)) +
  facet_wrap(~ Region)
}
```

## Extreme Outliers:

```{r}
outlier_by_regions(df, df$Incidents_HIV)
```

```{r}
outlier_by_regions(df, df$GDP_per_capita)
```

```{r}
outlier_by_regions(df, df$Population_mln)
```

## Filter Original Data Set by Region (Create Data Frame with Chosen Region Only Included):

```{r}
filter_out_region <- function(region) {
  var_name <- paste("df_with_", region, sep = "")
  assign(var_name, data %>%
           filter(Region == region), envir = .GlobalEnv)
}

```

```{r}
filter_out_region("Middle East")
```

```{r}
filter_out_region("European Union")
```

```{r}
filter_out_region("Asia")
```

```{r}
filter_out_region("South America")
```

```{r}
filter_out_region("Central America and Caribbean")
```

```{r}
filter_out_region("Rest of Europe")
```

```{r}
filter_out_region("Africa")
```

```{r}
filter_out_region("Oceania")
```

```{r}
filter_out_region("North America")
```

## Comparing Columns by Region:

```{r}
ggplot(df, aes(x = Region, y = Incidents_HIV)) +
geom_boxplot() +
ggtitle("Comparison of HIV Incidence by Region")
```

```{r}
ggplot(df, aes(x = Region, y = GDP_per_capita)) +
geom_boxplot() +
ggtitle("Comparison of GDP by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Population_mln)) +
geom_boxplot() +
ggtitle("Comparison of Population by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Life_expectancy)) +
geom_boxplot() +
ggtitle("Comparison of Life Expectancy by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Alcohol_consumption)) +
geom_boxplot() +
ggtitle("Comparison of Alcohol Consumption by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Hepatitis_B)) +
geom_boxplot() +
ggtitle("Comparison of Hepatitis B by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Measles)) +
geom_boxplot() +
ggtitle("Comparison of Measles by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Polio)) +
geom_boxplot() +
ggtitle("Comparison of Polio by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Diphtheria)) +
geom_boxplot() +
ggtitle("Comparison of Diphtheria by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Thinness_five_nine_years)) +
geom_boxplot() +
ggtitle("Comparison of Thinness Five to Nine Years by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Thinness_ten_nineteen_years)) +
geom_boxplot() +
ggtitle("Comparison of Thinness Ten to Nineteen Years by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Schooling)) +
geom_boxplot() +
ggtitle("Comparison of Schooling by Region")
```

```{r}
ggplot(df, aes(x = Region, y = BMI)) +
geom_boxplot() +
ggtitle("Comparison of BMI by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Infant_deaths)) +
geom_boxplot() +
ggtitle("Comparison of Infant Deaths by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Under_five_deaths)) +
geom_boxplot() +
ggtitle("Comparison of Under Five Deaths by Region")
```

```{r}
ggplot(df, aes(x = Region, y = Adult_mortality)) +
geom_boxplot() +
ggtitle("Comparison of Adult Mortality by Region")
```

## Treating Outliers:

### Identify Outliers:

#### Create Dataset with only numeric columns:

```{r}
numeric_columns <- df[, sapply(df, is.numeric)]
numeric_data <- data.frame(numeric_columns)
```

#### Function to return a list of outlier values for each column:

```{r}
identify_outliers <- function(data) {
  outliers <- list()
  
  for (i in which(sapply(data, is.numeric))) {
    col_name <- names(data)[i]
    
    perc <- quantile(data[, i], c(.25, .75 ), na.rm =TRUE)
    lower_fence <- perc[1] - 1.5 * IQR(data[, i])
    upper_fence <- perc[2] + 1.5 * IQR(data[, i])
    
    outlier_indices <- which(data[, i] < lower_fence | data[, i] > upper_fence)
    outliers[[col_name]] <- data[outlier_indices, i]
  }
  
  outliers2 <- outliers[sapply(outliers, length)>0]
  
  return(outliers2)
}
```

```{r}
outliers_vars <- identify_outliers(numeric_data)
outliers_vars
```

#### Function to Winsorize a column:

```{r}
df2 <- df
```

```{r}
GDP_per_capita_win <- Winsorize(df2$GDP_per_capita, minval = NULL, maxval = NULL, probs = c(0.05, 0.95), na.rm = TRUE, type = 1)
df2$GDP_per_capita <- GDP_per_capita_win
```

#### Validate Winsorization:

```{r}
# Compare outliers and boxplots before and after Winsorization
num_outliers(df, df$GDP_per_capita)
num_outliers(df2, df2$GDP_per_capita)


```
